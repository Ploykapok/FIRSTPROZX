-- ================= SAVE CONFIG =================
local CONFIG_FILE = "KittyHub_Config.json"
local HttpService = game:GetService("HttpService")

local Config = {
    SelectedStat = "Strength",
    SelectedSpots = {
        Strength = nil,
        Durability = nil,
        Chakra = nil,
        Sword = nil,
        Agility = nil,
        Speed = nil
    },
    AutoFarm = false,
    AutoChikara = false,
    AntiAFK = false,
    TrainOnly = {
        Strength = false,
        Durability = false,
        Chakra = false,
        Sword = false,
        Agility = false,
        Speed = false
    },
    SelectedMob = "Sarka [E]",
    AutoFarmMob = false
}

if isfile(CONFIG_FILE) then
    local data = readfile(CONFIG_FILE)
    local decoded = HttpService:JSONDecode(data)
    if decoded then
        Config = decoded
    end
end

local function SaveConfig()
    writefile(CONFIG_FILE, HttpService:JSONEncode(Config))
end

-- ================= SERVICES =================
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Remotes = ReplicatedStorage:WaitForChild("Remotes")
local TrainRemote = Remotes:WaitForChild("RemoteEvent")

-- ================= STATE =================
local selectedStat = Config.SelectedStat or "Strength"
local autoFarm = Config.AutoFarm or false
local autoChikaraBox = Config.AutoChikara or false
local antiAFK = Config.AntiAFK or false
local trainOnlyStats = Config.TrainOnly or {}
local selectedSpots = Config.SelectedSpots or {}
local selectedMob = Config.SelectedMob or "Sarka [E]"
local autoFarmMob = Config.AutoFarmMob or false

local STAT_ID = {
    Strength = 1, Durability = 2, Chakra = 3,
    Sword = 4, Agility = 5, Speed = 6
}

local MOB_ID = {
    ["Sarka [E]"] = 1, ["Gen [D]"] = 2, ["Igicho [C]"] = 3,
    ["Remgonuk [B]"] = 4, ["Booh [A]"] = 5, ["Saytamu [S]"] = 6,
    ["(Boss) Riru [SS]"] = 1001
}

-- ================= CHARACTER =================
local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

local VirtualUser = game:GetService("VirtualUser")
player.Idled:Connect(function()
    if antiAFK then
        VirtualUser:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
        task.wait(0.1)
        VirtualUser:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
    end
end)

-- ================= TELEPORT =================
local function teleportTo(target)
    if target and target:IsA("Model") then
        getHRP().CFrame = target:GetPivot()
    elseif target and target:IsA("BasePart") then
        getHRP().CFrame = target.CFrame
    end
end

local function teleportToTraining(spotName)
    local target = workspace.Map.TrainingAreas:FindFirstChild(spotName)
    if target then teleportTo(target) end
end

local function teleportToQuest(questName)
    local npcFolder = workspace:WaitForChild("Scriptable"):WaitForChild("NPC"):WaitForChild("Quest")
    local target = npcFolder:FindFirstChild(questName)
    if target then teleportTo(target) end
end

local chikaraLock = false
local chikaraCooldown = 5
local lastChikaraClick = 0
local chikaraClickDelay = 0.5

local function teleportAndClickChikaraBox()
    if chikaraLock then return end
    local now = os.clock()
    if now - lastChikaraClick < chikaraCooldown then return end
    chikaraLock = true
    lastChikaraClick = now
    local crate = workspace.Scriptable.ChikaraBoxes:FindFirstChild("ChikaraCrate")
    if crate then
        teleportTo(crate)
        task.wait(chikaraClickDelay)
        local clickBox = crate:FindFirstChild("ClickBox", true)
        if clickBox and clickBox:FindFirstChild("ClickDetector") then
            fireclickdetector(clickBox.ClickDetector)
        end
    end
    task.delay(0.6, function() chikaraLock = false end)
end

-- ================= UI =================
local Library = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/x2zu/OPEN-SOURCE-UI-ROBLOX/refs/heads/main/X2ZU%20UI%20ROBLOX%20OPEN%20SOURCE/DummyUi-leak-by-x2zu/fetching-main/Tools/Framework.luau"
))()

local Window = Library:Window({
    Title="Kitty Hub [AFS ENDLESS]",
    Desc="Auto Farm [FREEMIER]",
    Icon=105059922903197,
    Theme="Dark",
    Config={Keybind=Enum.KeyCode.LeftControl, Size=UDim2.new(0,450,0,350)},
    CloseUIButton={Enabled=true, Text="Close"}
})

-- ================= AUTO FARM TAB =================
local Tab = Window:Tab({Title="Auto Farm", Icon="star"})
Tab:Section({Title="Auto Farm Stat"})
Tab:Dropdown({
    Title="Select Stat",
    List={"Strength","Durability","Chakra","Sword","Agility","Speed"},
    Value=selectedStat,
    Callback=function(v)
        selectedStat=v
        Config.SelectedStat=v
        SaveConfig()
    end
})
Tab:Toggle({Title="Auto Farm", Value=autoFarm, Callback=function(v)
    autoFarm=v
    Config.AutoFarm=v
    SaveConfig()
end})

Tab:Section({Title="Select Spot"})
local function CreateSpotDropdown(title, list, statName)
    Tab:Dropdown({
        Title=title,
        List=list,
        Value=selectedSpots[statName],
        Callback=function(v)
            selectedSpots[statName]=v
            Config.SelectedSpots[statName]=v
            SaveConfig()
        end
    })
end
CreateSpotDropdown("Strength Spots", {"Training Dummy","Fridge","Gym","Meteor","Lookout","Arena","Excalibur","FloatingIsland","Pig","Boulder","HeavenlyPillar"},"Strength")
CreateSpotDropdown("Durability Spots", {"Pirate ship","Corp","Paw","BlackFire","Blackhole","Founder","King Kais","Time Chamber","Marine","IslandOfPower"},"Durability")
CreateSpotDropdown("Chakra Spots", {"Tree1","Waterfall","Library","ToriiGate","Fox","PinkSwords","Sage","Ice","RamenShop","Ultimate Dragon","DoorBox","Eyeball","IceTree"},"Chakra")
CreateSpotDropdown("Agility Spots", {"Trampoline","Gravity","KunaiGrounds","Church"},"Agility")
CreateSpotDropdown("Speed Spots", {"Treadmills","Gravity","KunaiGrounds","Church"},"Speed")

Tab:Section({Title="Auto Farm Chikara"})
Tab:Toggle({Title="Auto get Chikara Crate", Value=autoChikaraBox, Callback=function(v)
    autoChikaraBox=v
    Config.AutoChikara=v
    SaveConfig()
end})

Tab:Section({Title="Auto Farm Mob"})
Tab:Dropdown({
    Title="Select Mob",
    List={"Sarka [E]","Gen [D]","Igicho [C]","Remgonuk [B]","Booh [A]","Saytamu [S]","(Boss) Riru [SS]"},
    Value=selectedMob,
    Callback=function(v)
        selectedMob=v
        Config.SelectedMob=v
        SaveConfig()
    end
})
Tab:Toggle({
    Title="Auto Farm Mob",
    Value=autoFarmMob,
    Callback=function(v)
        autoFarmMob=v
        Config.AutoFarmMob=v
        SaveConfig()
    end
})

-- ================= TRAIN ONLY TAB =================
local TTab = Window:Tab({Title="Train Only", Icon="zap"})
TTab:Section({Title="Train only"})
for _, stat in ipairs({"Strength (Can Attack)","Durability","Chakra","Sword (Can Attack)","Agility","Speed"}) do
    TTab:Toggle({
        Title=stat,
        Value=trainOnlyStats[stat],
        Callback=function(v)
            trainOnlyStats[stat]=v
            Config.TrainOnly[stat]=v
            SaveConfig()
        end
    })
end

-- ================= QUEST TAB =================
local QTab = Window:Tab({Title="Teleport", Icon="map"})
QTab:Section({Title="Quest"})
for _, quest in ipairs({"Boom","Ghoul","Giovanni","Reindeer","Santa","Sword Master"}) do
    QTab:Button({Title=quest, Callback=function() teleportToQuest(quest) end})
end

-- ================= SETTING TAB =================
local STab = Window:Tab({Title="Setting", Icon="settings"})
STab:Section({Title="Settings"})
STab:Toggle({
    Title="Anti AFK",
    Desc="กันโดนเตะออกจากเกม",
    Value=antiAFK,
    Callback=function(v)
        antiAFK=v
        Config.AntiAFK=v
        SaveConfig()
    end
})

-- ================= AUTO FARM LOOP =================
task.spawn(function()
    while task.wait() do
        if autoFarm and selectedStat then
            local statId=STAT_ID[selectedStat]
            if selectedStat=="Sword" then
                TrainRemote:FireServer("Train", statId)
            else
                local spot=selectedSpots[selectedStat]
                if spot then
                    teleportToTraining(spot)
                    TrainRemote:FireServer("Train", statId)
                end
            end
        end
    end
end)

-- ================= AUTO CHIKARA LOOP =================
task.spawn(function()
    while task.wait(0.5) do
        if autoChikaraBox then
            teleportAndClickChikaraBox()
        end
    end
end)

-- ================= AUTO MOB LOOP =================
task.spawn(function()
    while task.wait() do
        if autoFarmMob then
            local mobId = MOB_ID[selectedMob]
            if mobId then
                local mob
                if mobId == 1001 then
                    mob = workspace.Scriptable.Mobs["1001"]
                else
                    mob = workspace.Scriptable.Mobs:FindFirstChild(tostring(mobId))
                end
                if mob then teleportTo(mob) end
            end
        end
    end
end)

-- ================= TRAIN ONLY LOOP =================
task.spawn(function()
    while task.wait(0.3) do
        for stat, enabled in pairs(trainOnlyStats) do
            if enabled then
                local statId=STAT_ID[stat]
                if statId then
                    TrainRemote:FireServer("Train", statId)
                end
            end
        end
    end
end)

-- ================= NOTIFY =================
Window:Notify({Title="Loaded", Desc="Kitty Hub | AFS ENLESS พร้อมใช้งาน✅", Time=4})
